#Written by Will Sumner
#Create compiler program

all: cminus

cminus: parser.tab.c lex.yy.c ast.c ast.h symtable.c symtable.h stack.c stack.h id.h yacc_header.h errors.c errors.h codegen.c codegen.h
	gcc -o cminus parser.tab.c lex.yy.c ast.c symtable.c errors.c stack.c codegen.c -ll -ly
cminusdebug: parser.tab.c lex.yy.c ast.c ast.h symtable.c symtable.h
	gcc -g -DDEBUG -o cminusdebug parser.tab.c lex.yy.c ast.c symtable.c errors.c -ll -ly

#Create parser.tab.c and parser.tab.h
parser.tab.c: parser.y lexer.l
	yacc -dv parser.y -o parser.tab.c

#Create lex.yy.c
lex.yy.c: lexer.l
	lex lexer.l

clean:
	-@rm -f cminus cminusdebug  2>/dev/null || true # remove binaries
	-@rm lex.yy.c *.lex 2>/dev/null || true # remove lex files
	-@rm parser.tab.h parser.tab.c 2>/dev/null || true # remove parser files
	-@rm -r parser.output *.dSYM/ 2>/dev/null || true # remove parser output files as well as debug folders

# rules for testing components
debug-symtable: sym.out
	lldb ./sym.out
sym.out: test-table.c symtable.c symtable.h
	gcc -g -DDEBUG test-table.c symtable.c -o sym.out

